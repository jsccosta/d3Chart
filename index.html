<!DOCTYPE html>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
    <script>
    function bubbleChart() {

  // Chart Attributes

  var width = 700,
      height = 300;

  var radiusExtent = [10, 50];

  var cScale = d3.scale.category10();

  var name = function(d) { return d.name; }

  var usage = function(d) { return d.usage; }

  var charge = function(d) { return -0.12 * d.r * d.r; }

  function chart(selection) {
      selection.each(function(data) {

          // Select the container div and configure its attributes
          var containerDiv = d3.select(this);

          // Sort the data items by usage, greater usage first.
          data.sort(function(a, b) { return usage(b) - usage(a); });

          // Compute unique browser names
          var nameList = data.map(name),
              uniqueNames = d3.set(nameList).values();

          // Set the scale domain
          cScale.domain(uniqueNames);

          // Create the radius scale
          var rScale = d3.scale.sqrt()
              .domain(d3.extent(data, usage))
              .range(radiusExtent);

          // Add the radius to each item, to compute it only once.
          data.forEach(function(d) { d.r = rScale(usage(d)); });

          // Configure the force layout.
          var force = d3.layout.force()
              .nodes(data)
              .links([])
              .size([width, height])
              .charge(function(d) { return -0.12 * d.r * d.r; })
              .start();

          containerDiv
              .style('position', 'relative')
              .style('width', width + 'px')
              .style('height', height + 'px')
              .style('padding', 0)
              .style('background-color', '#eeeeec');

          // Create a selection for the bubble divs, bind the data
          // array and set its attributes.
          var bubbleDivs = containerDiv.selectAll('div.bubble')
              .data(data)
              .enter()
              .append('div')
              .attr('class', 'bubble')
              .style('position', 'absolute')
              .style('border-radius', function(d) { return d.r + 'px'; })
              .style('border', 'solid 1px #222')
              .style('width', function(d) { return (2 * d.r) + 'px'; })
              .style('height', function(d) { return (2 * d.r) + 'px'; })
              .style('background-color', function(d) { return cScale(name(d)); });

          // Register a listener function for the force tick event, and
          // update the position of each div on tick.
          force.on('tick', function() {
              bubbleDivs
                  .style('top', function(d) { return (d.y - d.r) + 'px'; })
                  .style('left', function(d) { return (d.x - d.r)+ 'px'; });
          });
      });
  }

  // Accessor Methods

  // Width
  chart.width = function(value) {
      if (!arguments.length) { return width; }
      width = value;
      return chart;
  };

  // Height
  chart.height = function(value) {
      if (!arguments.length) { return height; }
      height = value;
      return chart;
  };

  // Radius Extent
  chart.radiusExtent = function(value) {
      if (!arguments.length) { return radiusExtent; }
      radiusExtent = value;
      return chart;
  };

  // Usage Accessor
  chart.usage = function(usageAccessor) {
      if (!arguments.length) { return usage; }
      usage = usageAccessor;
      return chart;
  };

  // Name Accessor
  chart.name = function(nameAccessor) {
      if (!arguments.length) { return name; }
      name = nameAccessor;
      return chart;
  };

  // Color Scale
  chart.colorScale = function(colorScale) {
      if (!arguments.length) { return cScale; }
      cScale = colorScale;
      return chart;
  };

  // Charge of the layout
  chart.charge = function(chargeMethod) {
      if (!arguments.length) { return charge; }
      charge = chargeMethod;
      return charge;
  }

  return chart;
};


// Load the data asynchronously
d3.json('/browsers.json', function(error, data) {

  // Handle errors getting or parsing the JSON data.
  if (error) { return error; }

  var chart = bubbleChart()
      .width(500);

  d3.select('#chart1e')
      .data([data.values])
      .call(chart);
});
    </script>
  </head>
  <body>
    <h1 class="section-title">Load Data</h1>

  <!-- Example of a data item -->
  <div class="chart-example">
    <pre id="chart1e"></pre>
</div>

  </body>
</html>
